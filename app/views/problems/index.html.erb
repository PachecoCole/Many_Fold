<h1><%= Problem.model_name.human.pluralize %></h1>

<%= paginate @problems %>

<form action="/problems" method="GET">
	<%= t ".filters" %>
	<div class="row">
		<div class="col">
			<label><%= t(".category") %></label>
			<select name="category[]" class="form-select" multiple=true>
				<% Problem::CATEGORIES.each do |cat| %>
					<option
						value="<%= cat %>"
						<%= "selected" if params[:category]&.include?(cat.to_s) %>
					><%= t("problems.categories.#{cat}") %></option>
				<% end %>
			</select>
		</div>
		<div class="col">
			<label><%= t(".severity") %></label>
			<select name="severity[]" class="form-select" multiple=true>
				<% (Problem::SEVERITIES - [:silent]).each do |sev| %>
					<option
						value="<%= sev %>"
						<%= "selected" if params[:severity]&.include?(sev.to_s) %>
					><%= t("problems.severities.#{sev}") %></option>
				<% end %>
			</select>
		</div>
		<div class="col">
			<label><%= t(".type") %></label>
			<select name="type[]" class="form-select" multiple=true>
				<option value="<%= Model.model_name.param_key %>"
					<%= "selected" if params[:type]&.include?(Model.model_name.param_key) %>
				><%= Model.model_name.human %></option>
				<option value="<%= ModelFile.model_name.param_key%>"
					<%= "selected" if params[:type]&.include?(ModelFile.model_name.param_key) %>
				><%= ModelFile.model_name.human %></option>
			</select>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<div class="form-check">
				<input class="form-check-input" type="checkbox" name="show_ignored" value="true"
					<%= "checked" if params[:show_ignored] == "true" %>
				>
				<label class="form-check-label" for="show_ignored">
					<%= t(".show_ignored") %>
				</label>
			</div>
		</div>
		<div class="col">
			<button type="submit" class="btn btn-primary"><%= t ".apply_filters" %></button>
			<a href='/problems' class="btn btn-secondary"><%= t ".clear_filters" %></a>
		</div>
	</div>
</form>

<table class="table table-striped">
	<% @problems.each do |problem| %>
		<tr class="table-<%= problem_severity(problem) %> <%= problem.ignored && "opacity-50"%>">
			<%= render partial: "#{problem.problematic_type.underscore}_#{problem.category}", locals: {problem: problem} %>
			<td>
				<% if problem.ignored %>
					<%= link_to icon("eye-fill", t(".unignore")), problem_path(problem, problem: { ignored: false }), method: :patch, class: "btn btn-outline-secondary" %>
				<% else %>
					<%= link_to icon("eye-slash", t(".ignore")), problem_path(problem, problem: { ignored: true }), method: :patch, class: "btn btn-outline-secondary" %>
				<% end %>
			</td>
		</tr>
	<% end %>
</table>

<%= paginate @problems %>
